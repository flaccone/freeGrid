# Project: FREEGRID 
# updated 20230531
# This file checks the geometric constraints GC of the benchmark
# required Python >= 3.7 (64 bit), numpy, pymeshlab
# input mesh to be in meters

import os
import sys
import pymeshlab
import numpy as np
import math
import argparse

class mesh:
    def __init__(self, meshPath):
        self.path = meshPath
        self.computeBasicAttr()
        self.computeEdges()
    
    def computeBasicAttr(self):
        ms = pymeshlab.MeshSet()
        ms.load_new_mesh(self.path)
        # vertices
        self.vn = ms.current_mesh().vertex_number()
        self.vm = ms.current_mesh().vertex_matrix()
        self.vNorm = ms.current_mesh().vertex_normal_matrix()
        # faces
        self.fm = ms.current_mesh().polygonal_face_list()
        self.fn = len(self.fm)
        # self.fNorm = ms.current_mesh().face_normal_matrix()
        # dimensions
        self.bb = ms.current_mesh().bounding_box()
        self.out_dict = ms.get_geometric_measures()
        # edges
        # avg_el = self.out_dict['avg_edge_length']
        # tot_el = self.out_dict['total_edge_length']
        # self.en = math.ceil(tot_el/avg_el)

    def printData(self):
        print('Verts number: ', self.vn)
        print('pFace number: ', self.fn)
        print('Edges number: ', self.en)

    def computeEdges(self):
        faceMatrix = self.fm
        edgeMa = []
        originFace = []
        for i in range (len(faceMatrix)):
            face = faceMatrix[i]
            for ii in range (np.shape(face)[0]):
                if face[ii] < face[ii-1]:
                    edge = [ face[ii], face[ii-1] ]
                else:
                    edge = [ face[ii-1], face[ii] ]
                edgeMa.append(edge)  # all edges (with duplicates)
                originFace.append(i) # corresponding face number
        edgeMatrix = np.array(edgeMa)
        em = np.unique(edgeMatrix, axis=0)
        
        # assert(self.en == np.shape(em)[0])
        self.en = np.shape(em)[0]

        # assebly face adjacency matrix per edge (one or two face number per edge)
        en = np.shape(em)[0] 
        adj = []
        for e in range(int(en)):
            currEdge = em[e]
            faces = []
            currEdgelist = currEdge.tolist()
            dupId = [i for i,edgeMa in enumerate(edgeMa) if edgeMa==currEdgelist]
            faces = [ originFace[i] for i in dupId]
            adj.append(faces)
        self.em = em
        self.adj = adj 

    def checkManifoldness(self):
        ms = pymeshlab.MeshSet()
        ms.load_new_mesh(self.path)
        ms.compute_selection_by_non_manifold_edges_per_face()
        if ms.current_mesh().selected_face_number() != 0:
            sys.exit('ERROR: the mesh has ' + str(ms.current_mesh().selected_face_number()) +' non-manifold edges') 
        ms.compute_selection_by_non_manifold_per_vertex()
        if ms.current_mesh().selected_vertex_number() != 0:
            sys.exit('ERROR: the mesh has ' + str(ms.current_mesh().selected_vertex_number()) + ' non-manifold vertices')
        print("GC.1 compliance: non-manifold vertices and edges not found")

    def checkHoles(self):
        ms = pymeshlab.MeshSet()
        ms.load_new_mesh(self.path)

        topo = ms.get_topological_measures()
        if topo['connected_components_number'] > 1:
            sys.exit('ERROR: the mesh has ' + str(topo['connected_components_number']) + ' connected components')

        # check if there is only one border (hole)
        if topo['number_holes'] > 1:
            sys.exit('ERROR: the mesh has ' + str(topo['number_holes']) + ' holes (missing panels)')
        elif topo['number_holes'] == 0:
            sys.exit('ERROR: the mesh has no borders, it is not a valid mesh for the benchmark')

        print("GC.1 compliance: no missing faces are found")
    
    def checkAreaProjection(self, baselineProjArea):
        ms = pymeshlab.MeshSet()
        ms.load_new_mesh(self.path)
        ms.generate_convex_hull()
        ms.set_current_mesh(1)
        hvm = ms.current_mesh().vertex_matrix()
        hfm = ms.current_mesh().face_matrix()
        hvm[:,2] = 0
        projectedHull = pymeshlab.Mesh(hvm,hfm)
        ms.add_mesh(projectedHull)
        ms.set_current_mesh(2)
        measures = ms.get_geometric_measures()
        area = measures['surface_area']/2
        if area <= 0.95 * baselineProjArea:
            sys.exit('ERROR: the mesh projected area is smaller than its reference DBG')
        else:
            print("GC.4 compliance: the mesh projected area is " + str(area))
    
    def checkRise(self):
        # computes the highest node having horizontal tangent plane
        # we refer to the verts and the face centroids, their tangent planes are orthogonal to their normals
        # so we check the closeness of the normals to the z axis [0, 0, 1]
        fm = self.fm
        vm = self.vm
        norm = []
        point = []
        zCoord = []
        zCloseness = []
        for i in range(int(self.fn)):
            pVerts = [ vm[f] for f in fm[i]]
            bfpNorm, centroid = bestFittingPlane(pVerts)
            norm.append(bfpNorm)
            point.append(centroid)
            zCoord.append(centroid[2])
            dprod = abs(np.dot(bfpNorm,[0,0,1]))
            zCloseness.append(math.acos(dprod))
        for ii in range(int(self.vn)):
            viiNorm = self.vNorm[ii]
            l = np.linalg.norm(viiNorm-[0,0,0])
            viiNormalized = viiNorm/l
            norm.append(viiNormalized)
            point.append(vm[ii])
            zCoord.append(vm[ii][2])
            dprod = abs(np.dot(viiNormalized,[0,0,1]))
            zCloseness.append(math.acos(dprod))
        indices = np.argsort(zCloseness)
        sortedzCloseness = np.array([zCloseness[id] for id in indices])
        sortedzCoord = np.array([zCoord[id] for id in indices])
        # adopting a tolerance of 0.06 rad
        cutzCloseness = sortedzCloseness[sortedzCloseness<0.06]
        cutzCoord = sortedzCoord[0:len(cutzCloseness)]
        rise = np.min(cutzCoord)
        # with a tolerance value of 0.1 m on the rise
        if rise < 3.75 - 0.1:
            sys.exit('ERROR: the rise is smaller than B/8')
        elif rise > 3.75 + 0.1:
            sys.exit('ERROR: the rise is larger than B/8')
        else:
            print("GC.5 compliance: the rise is " + str(rise))

    def chekNodesZspan(self):
        zCoord = self.vm[:,2]
        zMax = np.max(zCoord)
        zMin = np.min(zCoord)
        # check max heigth
        if zMax > 7.5 + 0.1:
            sys.exit('The height is larger than B/4')
        elif zMin < 0.0 - 0.1:
            sys.exit('There are nodes below the z = 0 plane')
        else:
            print("GC.6-7 compliance: the mesh has appropriate max and min height")

    def checkSLineCloseness(self, DBGspringLineMesh):
        ms = pymeshlab.MeshSet()
        ms.load_new_mesh(self.path)
        ms.add_mesh(DBGspringLineMesh)
        ms.compute_scalar_by_distance_from_another_mesh_per_vertex(measuremesh=1, refmesh=0, signeddist=False)
        quality = ms.current_mesh().vertex_scalar_array()
        maxDist = np.max(quality)
        # print(maxDist)
        if maxDist > 0.1:
            sys.exit('ERROR: the current mesh is too far from the DBG spring line')
        else:
            print("GC.2 compliance: the mesh is close to the spring line")

    def checkMaxSpan(self, DBGspringLineMesh, DBGcase):
        # select only vert on the border
        ms = pymeshlab.MeshSet()
        ms.load_new_mesh(self.path)
        ms.compute_selection_from_mesh_border()
        ms.compute_scalar_by_function_per_vertex(q = 'q = 1', onselected=True)
        # verts having 1 are borders
        colored = ms.current_mesh().vertex_scalar_array()
        colID = np.flatnonzero(colored)
        bordV = self.vm[colID,:]

        ms.add_mesh(DBGspringLineMesh)
        vertsSL = ms.current_mesh().vertex_matrix()

        # spring line closeness
        distantIDs = springLineCloseness(bordV,vertsSL)

        vx = bordV[distantIDs,0]
        vy = bordV[distantIDs,1]

        vxSL = vertsSL[:,0]
        vySL = vertsSL[:,1]

        if DBGcase == 0 or DBGcase == 1:
            xSpan = []
            for i in range(len(vy)):
                nearestIds = nearestValueIdx(vy[i], vySL)
                xvalue = []
                for id in range(len(nearestIds)):
                    xvalue.append( np.abs(vx[i]-vxSL[nearestIds[id]]) )
                if xvalue != []:
                    xSpan.append( min(xvalue) )
            span = np.max(xSpan)
        elif DBGcase == 2:
            ySpan = []
            for i in range(len(vx)):
                nearestIds = nearestValueIdx(vx[i], vxSL)
                yvalue = []
                for id in range(len(nearestIds)):
                    yvalue.append( np.abs(vy[i]-vySL[nearestIds[id]]) )
                if yvalue != []:
                    ySpan.append( min(yvalue) )
            span = np.max(ySpan)

        if span < 30 - 0.1:
            sys.exit("ERROR: the span is smaller than 30 m")
        else:
            print("GC.3 compliance: the span is larger than 30 m")
        

def bestFittingPlane(verts):
    #SVD best fitting plane
    x, y, z = (( []) for i in range(3) )
    for i in range(len(verts)):
        x.append(verts[i][0])
        y.append(verts[i][1])
        z.append(verts[i][2])
    v = np.array([np.array(x), np.array(y), np.array(z)])

    # subtract out the centroid and take the SVD
    centroid = np.mean(v, axis=1, keepdims=True)
    svd = np.linalg.svd(v - centroid)

    # Extract the left singular vectors
    left = svd[0]
    # the corresponding left singular vector is the normal vector of the best-fitting plane
    normFit = left[:, -1]
    return normFit, centroid.squeeze()

def createDBGdata(caseId):
    if caseId == 0:
        projectedArea = 956.3406982421875

        verts0 = np.array([
        [-15.      ,-15.60343   , 0.      ],
        [-15.      ,-15.498001  , 0.      ],
        [-15.      ,-15.287145  , 0.      ],
        [-15.      ,-15.076287  , 0.      ],
        [-15.      ,-14.86543   , 0.      ],
        [-15.      ,-14.654572  , 0.      ],
        [-15.      ,-14.443716  , 0.      ],
        [-15.      ,-14.232859  , 0.      ],
        [-15.      ,-14.022001  , 0.      ],
        [-15.      ,-13.811144  , 0.      ],
        [-15.      ,-13.600286  , 0.      ],
        [-15.      ,-13.38943   , 0.      ],
        [-15.      ,-13.178573  , 0.      ],
        [-15.      ,-12.967715  , 0.      ],
        [-15.      ,-12.756858  , 0.      ],
        [-15.      ,-12.546001  , 0.      ],
        [-15.      ,-12.335144  , 0.      ],
        [-15.      ,-12.124287  , 0.      ],
        [-15.      ,-11.913429  , 0.      ],
        [-15.      ,-11.702573  , 0.      ],
        [-15.      ,-11.491715  , 0.      ],
        [-15.      ,-11.280858  , 0.      ],
        [-15.      ,-11.070001  , 0.      ],
        [-15.      ,-10.859144  , 0.      ],
        [-15.      ,-10.648287  , 0.      ],
        [-15.      ,-10.437429  , 0.      ],
        [-15.      ,-10.226572  , 0.      ],
        [-15.      ,-10.015716  , 0.      ],
        [-15.      , -9.804858  , 0.      ],
        [-15.      , -9.594001  , 0.      ],
        [-15.      , -9.383143  , 0.      ],
        [-15.      , -9.172287  , 0.      ],
        [-15.      , -8.96143   , 0.      ],
        [-15.      , -8.750572  , 0.      ],
        [-15.      , -8.539715  , 0.      ],
        [-15.      , -8.328858  , 0.      ],
        [-15.      , -8.118001  , 0.      ],
        [-15.      , -7.907144  , 0.      ],
        [-15.      , -7.696286  , 0.      ],
        [-15.      , -7.485429  , 0.      ],
        [-15.      , -7.274572  , 0.      ],
        [-15.      , -7.063715  , 0.      ],
        [-15.      , -6.852858  , 0.      ],
        [-15.      , -6.642001  , 0.      ],
        [-15.      , -6.431143  , 0.      ],
        [-15.      , -6.220286  , 0.      ],
        [-15.      , -6.009429  , 0.      ],
        [-15.      , -5.798572  , 0.      ],
        [-15.      , -5.587715  , 0.      ],
        [-15.      , -5.376858  , 0.      ],
        [-15.      , -5.166     , 0.      ],
        [-15.      , -4.955143  , 0.      ],
        [-15.      , -4.744286  , 0.      ],
        [-15.      , -4.533429  , 0.      ],
        [-15.      , -4.322572  , 0.      ],
        [-15.      , -4.111715  , 0.      ],
        [-15.      , -3.900857  , 0.      ],
        [-15.      , -3.69      , 0.      ],
        [-15.      , -3.479143  , 0.      ],
        [-15.      , -3.268286  , 0.      ],
        [-15.      , -3.057429  , 0.      ],
        [-15.      , -2.846572  , 0.      ],
        [-15.      , -2.635715  , 0.      ],
        [-15.      , -2.424857  , 0.      ],
        [-15.      , -2.214     , 0.      ],
        [-15.      , -2.003143  , 0.      ],
        [-15.      , -1.792286  , 0.      ],
        [-15.      , -1.581429  , 0.      ],
        [-15.      , -1.370572  , 0.      ],
        [-15.      , -1.159714  , 0.      ],
        [-15.      , -0.948857  , 0.      ],
        [-15.      , -0.738     , 0.      ],
        [-15.      , -0.527143  , 0.      ],
        [-15.      , -0.316286  , 0.      ],
        [-15.      , -0.105429  , 0.      ],
        [-15.      ,  0.105429  , 0.      ],
        [-15.      ,  0.316286  , 0.      ],
        [-15.      ,  0.527143  , 0.      ],
        [-15.      ,  0.738     , 0.      ],
        [-15.      ,  0.948857  , 0.      ],
        [-15.      ,  1.159714  , 0.      ],
        [-15.      ,  1.370572  , 0.      ],
        [-15.      ,  1.581429  , 0.      ],
        [-15.      ,  1.792286  , 0.      ],
        [-15.      ,  2.003143  , 0.      ],
        [-15.      ,  2.214     , 0.      ],
        [-15.      ,  2.424857  , 0.      ],
        [-15.      ,  2.635715  , 0.      ],
        [-15.      ,  2.846572  , 0.      ],
        [-15.      ,  3.057429  , 0.      ],
        [-15.      ,  3.268286  , 0.      ],
        [-15.      ,  3.479143  , 0.      ],
        [-15.      ,  3.69      , 0.      ],
        [-15.      ,  3.900857  , 0.      ],
        [-15.      ,  4.111715  , 0.      ],
        [-15.      ,  4.322572  , 0.      ],
        [-15.      ,  4.533429  , 0.      ],
        [-15.      ,  4.744286  , 0.      ],
        [-15.      ,  4.955143  , 0.      ],
        [-15.      ,  5.166     , 0.      ],
        [-15.      ,  5.376858  , 0.      ],
        [-15.      ,  5.587715  , 0.      ],
        [-15.      ,  5.798572  , 0.      ],
        [-15.      ,  6.009429  , 0.      ],
        [-15.      ,  6.220286  , 0.      ],
        [-15.      ,  6.431143  , 0.      ],
        [-15.      ,  6.642001  , 0.      ],
        [-15.      ,  6.852858  , 0.      ],
        [-15.      ,  7.063715  , 0.      ],
        [-15.      ,  7.274572  , 0.      ],
        [-15.      ,  7.485429  , 0.      ],
        [-15.      ,  7.696286  , 0.      ],
        [-15.      ,  7.907144  , 0.      ],
        [-15.      ,  8.118001  , 0.      ],
        [-15.      ,  8.328858  , 0.      ],
        [-15.      ,  8.539715  , 0.      ],
        [-15.      ,  8.750572  , 0.      ],
        [-15.      ,  8.96143   , 0.      ],
        [-15.      ,  9.172287  , 0.      ],
        [-15.      ,  9.383143  , 0.      ],
        [-15.      ,  9.594001  , 0.      ],
        [-15.      ,  9.804858  , 0.      ],
        [-15.      , 10.015716  , 0.      ],
        [-15.      , 10.226572  , 0.      ],
        [-15.      , 10.437429  , 0.      ],
        [-15.      , 10.648287  , 0.      ],
        [-15.      , 10.859144  , 0.      ],
        [-15.      , 11.070001  , 0.      ],
        [-15.      , 11.280858  , 0.      ],
        [-15.      , 11.491715  , 0.      ],
        [-15.      , 11.702573  , 0.      ],
        [-15.      , 11.913429  , 0.      ],
        [-15.      , 12.124287  , 0.      ],
        [-15.      , 12.335144  , 0.      ],
        [-15.      , 12.546001  , 0.      ],
        [-15.      , 12.756858  , 0.      ],
        [-15.      , 12.967715  , 0.      ],
        [-15.      , 13.178573  , 0.      ],
        [-15.      , 13.38943   , 0.      ],
        [-15.      , 13.600286  , 0.      ],
        [-15.      , 13.811144  , 0.      ],
        [-15.      , 14.022001  , 0.      ],
        [-15.      , 14.232859  , 0.      ],
        [-15.      , 14.443716  , 0.      ],
        [-15.      , 14.654572  , 0.      ],
        [-15.      , 14.86543   , 0.      ],
        [-15.      , 15.076287  , 0.      ],
        [-15.      , 15.287145  , 0.      ],
        [-15.      , 15.498001  , 0.      ],
        [-15.      , 15.60343   , 0.      ],
        [ 15.      ,-15.60343   , 0.      ],
        [ 14.904834,-15.60343   , 0.045349],
        [ 14.714501,-15.60343   , 0.136048],
        [ 14.524168,-15.60343   , 0.226746],
        [ 14.333836,-15.60343   , 0.317445],
        [ 14.143502,-15.60343   , 0.408141],
        [ 13.953176,-15.60343   , 0.498854],
        [ 13.762805,-15.60343   , 0.589467],
        [ 13.572698,-15.60343   , 0.680664],
        [ 13.378323,-15.60343   , 0.762431],
        [ 13.18468 ,-15.60343   , 0.845816],
        [ 12.990911,-15.60343   , 0.928924],
        [ 12.797163,-15.60343   , 1.012074],
        [ 12.603425,-15.60343   , 1.095253],
        [ 12.409599,-15.60343   , 1.178215],
        [ 12.216289,-15.60343   , 1.262449],
        [ 12.019977,-15.60343   , 1.339268],
        [ 11.822829,-15.60343   , 1.414024],
        [ 11.625825,-15.60343   , 1.489134],
        [ 11.428795,-15.60343   , 1.564182],
        [ 11.231773,-15.60343   , 1.639251],
        [ 11.034729,-15.60343   , 1.714254],
        [ 10.837817,-15.60343   , 1.789633],
        [ 10.640127,-15.60343   , 1.862823],
        [ 10.439613,-15.60343   , 1.928092],
        [ 10.239585,-15.60343   , 1.99472 ],
        [ 10.039474,-15.60343   , 2.061116],
        [  9.839373,-15.60343   , 2.127542],
        [  9.639288,-15.60343   , 2.194019],
        [  9.4391  ,-15.60343   , 2.260161],
        [  9.239513,-15.60343   , 2.328262],
        [  9.036422,-15.60343   , 2.384944],
        [  8.833544,-15.60343   , 2.442322],
        [  8.63063 ,-15.60343   , 2.499581],
        [  8.42772 ,-15.60343   , 2.556855],
        [  8.224816,-15.60343   , 2.614155],
        [  8.021871,-15.60343   , 2.671289],
        [  7.819174,-15.60343   , 2.729391],
        [  7.615028,-15.60343   , 2.781852],
        [  7.409428,-15.60343   , 2.828657],
        [  7.204077,-15.60343   , 2.876431],
        [  6.998684,-15.60343   , 2.92404 ],
        [  6.793297,-15.60343   , 2.971674],
        [  6.587914,-15.60343   , 3.019325],
        [  6.382504,-15.60343   , 3.066843],
        [  6.177255,-15.60343   , 3.115146],
        [  5.969407,-15.60343   , 3.150852],
        [  5.762005,-15.60343   , 3.18872 ],
        [  5.554527,-15.60343   , 3.226218],
        [  5.347061,-15.60343   , 3.263772],
        [  5.139599,-15.60343   , 3.301363],
        [  4.932095,-15.60343   , 3.338674],
        [  4.724845,-15.60343   , 3.377627],
        [  4.51611 ,-15.60343   , 3.407005],
        [  4.306961,-15.60343   , 3.433717],
        [  4.097882,-15.60343   , 3.460888],
        [  3.888791,-15.60343   , 3.487977],
        [  3.679704,-15.60343   , 3.515093],
        [  3.470608,-15.60343   , 3.542127],
        [  3.26156 ,-15.60343   , 3.569629],
        [  3.05223 ,-15.60343   , 3.594407],
        [  2.84188 ,-15.60343   , 3.609343],
        [  2.631704,-15.60343   , 3.625968],
        [  2.421499,-15.60343   , 3.642304],
        [  2.211298,-15.60343   , 3.658679],
        [  2.0011  ,-15.60343   , 3.675114],
        [  1.790881,-15.60343   , 3.691149],
        [  1.580783,-15.60343   , 3.709519],
        [  1.36998 ,-15.60343   , 3.714284],
        [  1.159219,-15.60343   , 3.719885],
        [  0.948451,-15.60343   , 3.725344],
        [  0.737684,-15.60343   , 3.730821],
        [  0.526917,-15.60343   , 3.736327],
        [  0.31615 ,-15.60343   , 3.741644],
        [  0.105383,-15.60343   , 3.748063],
        [ -0.105384,-15.60343   , 3.748063],
        [ -0.31615 ,-15.60343   , 3.741644],
        [ -0.526917,-15.60343   , 3.736327],
        [ -0.737684,-15.60343   , 3.730821],
        [ -0.948451,-15.60343   , 3.725344],
        [ -1.159219,-15.60343   , 3.719885],
        [ -1.36998 ,-15.60343   , 3.714284],
        [ -1.580784,-15.60343   , 3.709519],
        [ -1.790881,-15.60343   , 3.691149],
        [ -2.0011  ,-15.60343   , 3.675114],
        [ -2.211298,-15.60343   , 3.658679],
        [ -2.421499,-15.60343   , 3.642304],
        [ -2.631705,-15.60343   , 3.625968],
        [ -2.84188 ,-15.60343   , 3.609344],
        [ -3.052231,-15.60343   , 3.594407],
        [ -3.26156 ,-15.60343   , 3.569629],
        [ -3.470608,-15.60343   , 3.542127],
        [ -3.679704,-15.60343   , 3.515093],
        [ -3.888791,-15.60343   , 3.487977],
        [ -4.097882,-15.60343   , 3.460887],
        [ -4.306961,-15.60343   , 3.433717],
        [ -4.51611 ,-15.60343   , 3.407005],
        [ -4.724845,-15.60343   , 3.377626],
        [ -4.932095,-15.60343   , 3.338673],
        [ -5.139599,-15.60343   , 3.301362],
        [ -5.347061,-15.60343   , 3.263771],
        [ -5.554527,-15.60343   , 3.226218],
        [ -5.762005,-15.60343   , 3.18872 ],
        [ -5.969407,-15.60343   , 3.150852],
        [ -6.177255,-15.60343   , 3.115146],
        [ -6.382504,-15.60343   , 3.066844],
        [ -6.587914,-15.60343   , 3.019326],
        [ -6.793298,-15.60343   , 2.971674],
        [ -6.998684,-15.60343   , 2.924041],
        [ -7.204077,-15.60343   , 2.876432],
        [ -7.409428,-15.60343   , 2.828657],
        [ -7.615028,-15.60343   , 2.781853],
        [ -7.819174,-15.60343   , 2.729391],
        [ -8.021872,-15.60343   , 2.671289],
        [ -8.224817,-15.60343   , 2.614155],
        [ -8.42772 ,-15.60343   , 2.556855],
        [ -8.63063 ,-15.60343   , 2.499581],
        [ -8.833544,-15.60343   , 2.442322],
        [ -9.036423,-15.60343   , 2.384944],
        [ -9.239514,-15.60343   , 2.328262],
        [ -9.4391  ,-15.60343   , 2.260162],
        [ -9.639289,-15.60343   , 2.19402 ],
        [ -9.839374,-15.60343   , 2.127543],
        [-10.039474,-15.60343   , 2.061117],
        [-10.239586,-15.60343   , 1.994722],
        [-10.439615,-15.60343   , 1.928095],
        [-10.640128,-15.60343   , 1.862826],
        [-10.837819,-15.60343   , 1.789636],
        [-11.03473 ,-15.60343   , 1.714257],
        [-11.231774,-15.60343   , 1.639253],
        [-11.428796,-15.60343   , 1.564184],
        [-11.625825,-15.60343   , 1.489136],
        [-11.822829,-15.60343   , 1.414025],
        [-12.019977,-15.60343   , 1.339269],
        [-12.216289,-15.60343   , 1.262449],
        [-12.409599,-15.60343   , 1.178215],
        [-12.603425,-15.60343   , 1.095253],
        [-12.797163,-15.60343   , 1.012074],
        [-12.990911,-15.60343   , 0.928924],
        [-13.18468 ,-15.60343   , 0.845816],
        [-13.378323,-15.60343   , 0.762431],
        [-13.572698,-15.60343   , 0.680664],
        [-13.762805,-15.60343   , 0.589467],
        [-13.953176,-15.60343   , 0.498854],
        [-14.143502,-15.60343   , 0.408141],
        [-14.333836,-15.60343   , 0.317445],
        [-14.524168,-15.60343   , 0.226746],
        [-14.714501,-15.60343   , 0.136048],
        [-14.904834,-15.60343   , 0.045349],
        [-15.      ,-15.60343   , 0.      ],
        [-15.      , 15.60343   , 0.      ],
        [-14.904834, 15.60343   , 0.045349],
        [-14.714501, 15.60343   , 0.136048],
        [-14.524168, 15.60343   , 0.226746],
        [-14.333836, 15.60343   , 0.317445],
        [-14.143502, 15.60343   , 0.408141],
        [-13.953176, 15.60343   , 0.498854],
        [-13.762805, 15.60343   , 0.589467],
        [-13.572698, 15.60343   , 0.680664],
        [-13.378323, 15.60343   , 0.762431],
        [-13.18468 , 15.60343   , 0.845816],
        [-12.990911, 15.60343   , 0.928924],
        [-12.797163, 15.60343   , 1.012074],
        [-12.603425, 15.60343   , 1.095253],
        [-12.409599, 15.60343   , 1.178215],
        [-12.216289, 15.60343   , 1.262449],
        [-12.019977, 15.60343   , 1.339269],
        [-11.822829, 15.60343   , 1.414025],
        [-11.625825, 15.60343   , 1.489136],
        [-11.428796, 15.60343   , 1.564184],
        [-11.231774, 15.60343   , 1.639253],
        [-11.03473 , 15.60343   , 1.714257],
        [-10.837819, 15.60343   , 1.789636],
        [-10.640128, 15.60343   , 1.862826],
        [-10.439615, 15.60343   , 1.928095],
        [-10.239586, 15.60343   , 1.994722],
        [-10.039474, 15.60343   , 2.061117],
        [ -9.839374, 15.60343   , 2.127543],
        [ -9.639289, 15.60343   , 2.19402 ],
        [ -9.4391  , 15.60343   , 2.260162],
        [ -9.239514, 15.60343   , 2.328262],
        [ -9.036423, 15.60343   , 2.384944],
        [ -8.833544, 15.60343   , 2.442322],
        [ -8.63063 , 15.60343   , 2.499581],
        [ -8.42772 , 15.60343   , 2.556855],
        [ -8.224817, 15.60343   , 2.614155],
        [ -8.021872, 15.60343   , 2.671289],
        [ -7.819174, 15.60343   , 2.729391],
        [ -7.615028, 15.60343   , 2.781853],
        [ -7.409428, 15.60343   , 2.828657],
        [ -7.204077, 15.60343   , 2.876432],
        [ -6.998684, 15.60343   , 2.924041],
        [ -6.793298, 15.60343   , 2.971674],
        [ -6.587914, 15.60343   , 3.019326],
        [ -6.382504, 15.60343   , 3.066844],
        [ -6.177255, 15.60343   , 3.115146],
        [ -5.969407, 15.60343   , 3.150852],
        [ -5.762005, 15.60343   , 3.18872 ],
        [ -5.554527, 15.60343   , 3.226218],
        [ -5.347061, 15.60343   , 3.263771],
        [ -5.139599, 15.60343   , 3.301362],
        [ -4.932095, 15.60343   , 3.338673],
        [ -4.724845, 15.60343   , 3.377626],
        [ -4.51611 , 15.60343   , 3.407005],
        [ -4.306961, 15.60343   , 3.433717],
        [ -4.097882, 15.60343   , 3.460887],
        [ -3.888791, 15.60343   , 3.487977],
        [ -3.679704, 15.60343   , 3.515093],
        [ -3.470608, 15.60343   , 3.542127],
        [ -3.26156 , 15.60343   , 3.569629],
        [ -3.052231, 15.60343   , 3.594407],
        [ -2.84188 , 15.60343   , 3.609344],
        [ -2.631705, 15.60343   , 3.625968],
        [ -2.421499, 15.60343   , 3.642304],
        [ -2.211298, 15.60343   , 3.658679],
        [ -2.0011  , 15.60343   , 3.675114],
        [ -1.790881, 15.60343   , 3.691149],
        [ -1.580784, 15.60343   , 3.709519],
        [ -1.36998 , 15.60343   , 3.714284],
        [ -1.159219, 15.60343   , 3.719885],
        [ -0.948451, 15.60343   , 3.725344],
        [ -0.737684, 15.60343   , 3.730821],
        [ -0.526917, 15.60343   , 3.736327],
        [ -0.31615 , 15.60343   , 3.741644],
        [ -0.105384, 15.60343   , 3.748063],
        [  0.105383, 15.60343   , 3.748063],
        [  0.31615 , 15.60343   , 3.741644],
        [  0.526917, 15.60343   , 3.736327],
        [  0.737684, 15.60343   , 3.730821],
        [  0.948451, 15.60343   , 3.725344],
        [  1.159219, 15.60343   , 3.719885],
        [  1.36998 , 15.60343   , 3.714284],
        [  1.580783, 15.60343   , 3.709519],
        [  1.790881, 15.60343   , 3.691149],
        [  2.0011  , 15.60343   , 3.675114],
        [  2.211298, 15.60343   , 3.658679],
        [  2.421499, 15.60343   , 3.642304],
        [  2.631704, 15.60343   , 3.625968],
        [  2.84188 , 15.60343   , 3.609343],
        [  3.05223 , 15.60343   , 3.594407],
        [  3.26156 , 15.60343   , 3.569629],
        [  3.470608, 15.60343   , 3.542127],
        [  3.679704, 15.60343   , 3.515093],
        [  3.888791, 15.60343   , 3.487977],
        [  4.097882, 15.60343   , 3.460888],
        [  4.306961, 15.60343   , 3.433717],
        [  4.51611 , 15.60343   , 3.407005],
        [  4.724845, 15.60343   , 3.377627],
        [  4.932095, 15.60343   , 3.338674],
        [  5.139599, 15.60343   , 3.301363],
        [  5.347061, 15.60343   , 3.263772],
        [  5.554527, 15.60343   , 3.226218],
        [  5.762005, 15.60343   , 3.18872 ],
        [  5.969407, 15.60343   , 3.150852],
        [  6.177255, 15.60343   , 3.115146],
        [  6.382504, 15.60343   , 3.066843],
        [  6.587914, 15.60343   , 3.019325],
        [  6.793297, 15.60343   , 2.971674],
        [  6.998684, 15.60343   , 2.92404 ],
        [  7.204077, 15.60343   , 2.876431],
        [  7.409428, 15.60343   , 2.828657],
        [  7.615028, 15.60343   , 2.781852],
        [  7.819174, 15.60343   , 2.729391],
        [  8.021871, 15.60343   , 2.671289],
        [  8.224816, 15.60343   , 2.614155],
        [  8.42772 , 15.60343   , 2.556855],
        [  8.63063 , 15.60343   , 2.499581],
        [  8.833544, 15.60343   , 2.442322],
        [  9.036422, 15.60343   , 2.384944],
        [  9.239513, 15.60343   , 2.328262],
        [  9.4391  , 15.60343   , 2.260161],
        [  9.639288, 15.60343   , 2.194019],
        [  9.839373, 15.60343   , 2.127542],
        [ 10.039474, 15.60343   , 2.061116],
        [ 10.239585, 15.60343   , 1.99472 ],
        [ 10.439613, 15.60343   , 1.928092],
        [ 10.640127, 15.60343   , 1.862823],
        [ 10.837817, 15.60343   , 1.789633],
        [ 11.034729, 15.60343   , 1.714254],
        [ 11.231773, 15.60343   , 1.639251],
        [ 11.428795, 15.60343   , 1.564182],
        [ 11.625825, 15.60343   , 1.489134],
        [ 11.822829, 15.60343   , 1.414024],
        [ 12.019977, 15.60343   , 1.339268],
        [ 12.216289, 15.60343   , 1.262449],
        [ 12.409599, 15.60343   , 1.178215],
        [ 12.603425, 15.60343   , 1.095253],
        [ 12.797163, 15.60343   , 1.012074],
        [ 12.990911, 15.60343   , 0.928924],
        [ 13.18468 , 15.60343   , 0.845816],
        [ 13.378323, 15.60343   , 0.762431],
        [ 13.572698, 15.60343   , 0.680664],
        [ 13.762805, 15.60343   , 0.589467],
        [ 13.953176, 15.60343   , 0.498854],
        [ 14.143502, 15.60343   , 0.408141],
        [ 14.333836, 15.60343   , 0.317445],
        [ 14.524168, 15.60343   , 0.226746],
        [ 14.714501, 15.60343   , 0.136048],
        [ 14.904834, 15.60343   , 0.045349],
        [ 15.      , 15.60343   , 0.      ]
        ])
        
        m = pymeshlab.Mesh(verts0)

    elif caseId ==1:
        projectedArea = 704.6748046875

        verts1 = np.array([
            [  7.486607 , 12.96718  ,  0.      ],
            [  7.395895 , 13.020765 ,  0.      ],
            [  7.213134 , 13.125641 ,  0.      ],
            [  7.029091 , 13.228248 ,  0.      ],
            [  6.843815 , 13.328612 ,  0.      ],
            [  6.657361 , 13.426771 ,  0.      ],
            [  6.469758 , 13.522713 ,  0.      ],
            [  6.281164 , 13.616698 ,  0.      ],
            [  6.090913 , 13.707292 ,  0.      ],
            [  5.898245 , 13.792635 ,  0.      ],
            [  5.703637 , 13.873446 ,  0.      ],
            [  5.507362 , 13.950114 ,  0.      ],
            [  5.309692 , 14.023108 ,  0.      ],
            [  5.110867 , 14.092886 ,  0.      ],
            [  4.9111   , 14.159922 ,  0.      ],
            [  4.710588 , 14.224686 ,  0.      ],
            [  4.509509 , 14.287672 ,  0.      ],
            [  4.307878 , 14.348865 ,  0.      ],
            [  4.10565  , 14.408058 ,  0.      ],
            [  3.902797 , 14.465074 ,  0.      ],
            [  3.699295 , 14.519728 ,  0.      ],
            [  3.495126 , 14.571835 ,  0.      ],
            [  3.290278 , 14.621209 ,  0.      ],
            [  3.084747 , 14.66766  ,  0.      ],
            [  2.878544 , 14.711034 ,  0.      ],
            [  2.671722 , 14.751348 ,  0.      ],
            [  2.464329 , 14.788615 ,  0.      ],
            [  2.256414 , 14.822849 ,  0.      ],
            [  2.048024 , 14.854066 ,  0.      ],
            [  1.839207 , 14.882276 ,  0.      ],
            [  1.630006 , 14.907494 ,  0.      ],
            [  1.420469 , 14.929731 ,  0.      ],
            [  1.210635 , 14.948979 ,  0.      ],
            [  1.000547 , 14.965211 ,  0.      ],
            [  0.790245 , 14.978402 ,  0.      ],
            [  0.579774 , 14.988531 ,  0.      ],
            [  0.369177 , 14.995572 ,  0.      ],
            [  0.158499 , 14.999502 ,  0.      ],
            [ -0.052214 , 15.000297 ,  0.      ],
            [ -0.262916 , 14.997944 ,  0.      ],
            [ -0.47356  , 14.992468 ,  0.      ],
            [ -0.6841   , 14.983893 ,  0.      ],
            [ -0.894492 , 14.972244 ,  0.      ],
            [ -1.104693 , 14.957542 ,  0.      ],
            [ -1.314661 , 14.939815 ,  0.      ],
            [ -1.524352 , 14.919082 ,  0.      ],
            [ -1.733729 , 14.89537  ,  0.      ],
            [ -1.942745 , 14.868673 ,  0.      ],
            [ -2.151357 , 14.838977 ,  0.      ],
            [ -2.359517 , 14.806268 ,  0.      ],
            [ -2.56718  , 14.770533 ,  0.      ],
            [ -2.774296 , 14.731756 ,  0.      ],
            [ -2.980817 , 14.689926 ,  0.      ],
            [ -3.186691 , 14.645017 ,  0.      ],
            [ -3.391881 , 14.597084 ,  0.      ],
            [ -3.596389 , 14.546326 ,  0.      ],
            [ -3.800225 , 14.492927 ,  0.      ],
            [ -4.003402 , 14.437076 ,  0.      ],
            [ -4.205942 , 14.378958 ,  0.      ],
            [ -4.407872 , 14.318758 ,  0.      ],
            [ -4.609225 , 14.256657 ,  0.      ],
            [ -4.810047 , 14.192857 ,  0.      ],
            [ -5.010222 , 14.127056 ,  0.      ],
            [ -5.209557 , 14.058745 ,  0.      ],
            [ -5.407845 , 13.987453 ,  0.      ],
            [ -5.604859 , 13.912706 ,  0.      ],
            [ -5.800342 , 13.834036 ,  0.      ],
            [ -5.994012 , 13.750999 ,  0.      ],
            [ -6.185521 , 13.663087 ,  0.      ],
            [ -6.37471  , 13.5703   ,  0.      ],
            [ -6.56316  , 13.476036 ,  0.      ],
            [ -6.750766 , 13.380097 ,  0.      ],
            [ -6.937425 , 13.282331 ,  0.      ],
            [ -7.123031 , 13.18258  ,  0.      ],
            [ -7.307471 , 13.080686 ,  0.      ],
            [ -7.490623 , 12.976498 ,  0.      ],
            [ -7.672367 , 12.869867 ,  0.      ],
            [ -7.852563 , 12.760644 ,  0.      ],
            [ -8.031185 , 12.648864 ,  0.      ],
            [ -8.20825  , 12.534635 ,  0.      ],
            [ -8.383773 , 12.418049 ,  0.      ],
            [ -8.557771 , 12.299201 ,  0.      ],
            [ -8.730267 , 12.178181 ,  0.      ],
            [ -8.90128  , 12.055079 ,  0.      ],
            [ -9.070685 , 11.929769 ,  0.      ],
            [ -9.238297 , 11.80207  ,  0.      ],
            [ -9.403961 , 11.671854 ,  0.      ],
            [ -9.567653 , 11.539167 ,  0.      ],
            [ -9.72935  , 11.404058 ,  0.      ],
            [ -9.889031 , 11.26657  ,  0.      ],
            [-10.046675 , 11.126751 ,  0.      ],
            [-10.202257 , 10.984644 ,  0.      ],
            [-10.355759 , 10.840289 ,  0.      ],
            [-10.507154 , 10.693729 ,  0.      ],
            [-10.656423 , 10.545004 ,  0.      ],
            [-10.803533 , 10.39414  ,  0.      ],
            [-10.948447 , 10.241169 ,  0.      ],
            [-11.091125 , 10.086108 ,  0.      ],
            [-11.231525 ,  9.928983 ,  0.      ],
            [-11.369604 ,  9.769814 ,  0.      ],
            [-11.505319 ,  9.608623 ,  0.      ],
            [-11.63862  ,  9.445432 ,  0.      ],
            [-11.769465 ,  9.280264 ,  0.      ],
            [-11.897795 ,  9.113134 ,  0.      ],
            [-12.02369  ,  8.944164 ,  0.      ],
            [-12.14733  ,  8.773538 ,  0.      ],
            [-12.26888  ,  8.601416 ,  0.      ],
            [-12.388285 ,  8.427799 ,  0.      ],
            [-12.505449 ,  8.252663 ,  0.      ],
            [-12.620282 ,  8.075988 ,  0.      ],
            [-12.732688 ,  7.89776  ,  0.      ],
            [-12.842569 ,  7.717963 ,  0.      ],
            [-12.949841 ,  7.536598 ,  0.      ],
            [-13.054631 ,  7.353788 ,  0.      ],
            [-13.157089 ,  7.169662 ,  0.      ],
            [-13.257367 ,  6.98434  ,  0.      ],
            [-13.355618 ,  6.797935 ,  0.      ],
            [-13.452009 ,  6.610562 ,  0.      ],
            [-13.546642 ,  6.422297 ,  0.      ],
            [-13.640008 ,  6.233394 ,  0.      ],
            [-13.72933  ,  6.042542 ,  0.      ],
            [-13.813519 ,  5.849367 ,  0.      ],
            [-13.893254 ,  5.654317 ,  0.      ],
            [-13.968946 ,  5.457663 ,  0.      ],
            [-14.041065 ,  5.259673 ,  0.      ],
            [-14.110083 ,  5.060582 ,  0.      ],
            [-14.176473 ,  4.8606   ,  0.      ],
            [-14.240724 ,  4.659923 ,  0.      ],
            [-14.303267 ,  4.458707 ,  0.      ],
            [-14.363964 ,  4.256926 ,  0.      ],
            [-14.422625 ,  4.054543 ,  0.      ],
            [-14.479065 ,  3.851529 ,  0.      ],
            [-14.533099 ,  3.647861 ,  0.      ],
            [-14.584541 ,  3.443523 ,  0.      ],
            [-14.633205 ,  3.238505 ,  0.      ],
            [-14.678891 ,  3.032803 ,  0.      ],
            [-14.721495 ,  2.82644  ,  0.      ],
            [-14.761041 ,  2.619469 ,  0.      ],
            [-14.797542 ,  2.41194  ,  0.      ],
            [-14.831012 ,  2.2039   ,  0.      ],
            [-14.861466 ,  1.9954   ,  0.      ],
            [-14.888919 ,  1.78648  ,  0.      ],
            [-14.913383 ,  1.57719  ,  0.      ],
            [-14.934868 ,  1.367574 ,  0.      ],
            [-14.953357 ,  1.157672 ,  0.      ],
            [-14.968823 ,  0.947526 ,  0.      ],
            [-14.981245 ,  0.737178 ,  0.      ],
            [-14.990598 ,  0.526671 ,  0.      ],
            [-14.996857 ,  0.316049 ,  0.      ],
            [-14.999999 ,  0.105357 ,  0.      ],
            [-14.999999 , -0.105357 ,  0.      ],
            [-14.996857 , -0.316049 ,  0.      ],
            [-14.990598 , -0.526671 ,  0.      ],
            [-14.981245 , -0.737178 ,  0.      ],
            [-14.968823 , -0.947526 ,  0.      ],
            [-14.953357 , -1.157672 ,  0.      ],
            [-14.934868 , -1.367574 ,  0.      ],
            [-14.913383 , -1.57719  ,  0.      ],
            [-14.888919 , -1.78648  ,  0.      ],
            [-14.861466 , -1.995398 ,  0.      ],
            [-14.831012 , -2.203901 ,  0.      ],
            [-14.797542 , -2.41194  ,  0.      ],
            [-14.761041 , -2.619469 ,  0.      ],
            [-14.721495 , -2.82644  ,  0.      ],
            [-14.678891 , -3.032804 ,  0.      ],
            [-14.633205 , -3.238505 ,  0.      ],
            [-14.584541 , -3.443523 ,  0.      ],
            [-14.533099 , -3.647861 ,  0.      ],
            [-14.479065 , -3.851529 ,  0.      ],
            [-14.422625 , -4.054543 ,  0.      ],
            [-14.363964 , -4.256926 ,  0.      ],
            [-14.303267 , -4.458707 ,  0.      ],
            [-14.240724 , -4.659923 ,  0.      ],
            [-14.176473 , -4.860601 ,  0.      ],
            [-14.110083 , -5.060583 ,  0.      ],
            [-14.041065 , -5.259673 ,  0.      ],
            [-13.968946 , -5.457663 ,  0.      ],
            [-13.893254 , -5.654317 ,  0.      ],
            [-13.813519 , -5.849367 ,  0.      ],
            [-13.72933  , -6.042542 ,  0.      ],
            [-13.640008 , -6.233394 ,  0.      ],
            [-13.546642 , -6.422297 ,  0.      ],
            [-13.452009 , -6.610562 ,  0.      ],
            [-13.355618 , -6.797935 ,  0.      ],
            [-13.257367 , -6.98434  ,  0.      ],
            [-13.157089 , -7.169662 ,  0.      ],
            [-13.054631 , -7.353788 ,  0.      ],
            [-12.949841 , -7.536598 ,  0.      ],
            [-12.842569 , -7.717963 ,  0.      ],
            [-12.732689 , -7.897759 ,  0.      ],
            [-12.620282 , -8.075988 ,  0.      ],
            [-12.505449 , -8.252663 ,  0.      ],
            [-12.388285 , -8.427799 ,  0.      ],
            [-12.26888  , -8.601416 ,  0.      ],
            [-12.14733  , -8.773538 ,  0.      ],
            [-12.02369  , -8.944164 ,  0.      ],
            [-11.897795 , -9.113134 ,  0.      ],
            [-11.769465 , -9.280264 ,  0.      ],
            [-11.63862  , -9.445432 ,  0.      ],
            [-11.505319 , -9.608623 ,  0.      ],
            [-11.369604 , -9.769814 ,  0.      ],
            [-11.231525 , -9.928983 ,  0.      ],
            [-11.091125 ,-10.086108 ,  0.      ],
            [-10.948447 ,-10.241169 ,  0.      ],
            [-10.803533 ,-10.39414  ,  0.      ],
            [-10.656423 ,-10.545003 ,  0.      ],
            [-10.507154 ,-10.693729 ,  0.      ],
            [-10.355759 ,-10.840289 ,  0.      ],
            [-10.202257 ,-10.984644 ,  0.      ],
            [-10.046675 ,-11.126751 ,  0.      ],
            [ -9.889031 ,-11.26657  ,  0.      ],
            [ -9.72935  ,-11.404058 ,  0.      ],
            [ -9.567653 ,-11.539167 ,  0.      ],
            [ -9.403961 ,-11.671854 ,  0.      ],
            [ -9.238297 ,-11.80207  ,  0.      ],
            [ -9.070685 ,-11.929769 ,  0.      ],
            [ -8.90128  ,-12.055079 ,  0.      ],
            [ -8.730266 ,-12.178181 ,  0.      ],
            [ -8.557772 ,-12.299201 ,  0.      ],
            [ -8.383773 ,-12.418049 ,  0.      ],
            [ -8.20825  ,-12.534634 ,  0.      ],
            [ -8.031184 ,-12.648864 ,  0.      ],
            [ -7.852563 ,-12.760644 ,  0.      ],
            [ -7.672366 ,-12.869867 ,  0.      ],
            [ -7.490624 ,-12.976498 ,  0.      ],
            [ -7.30747  ,-13.080686 ,  0.      ],
            [ -7.123031 ,-13.18258  ,  0.      ],
            [ -6.937425 ,-13.282331 ,  0.      ],
            [ -6.750765 ,-13.380097 ,  0.      ],
            [ -6.56316  ,-13.476035 ,  0.      ],
            [ -6.37471  ,-13.5703   ,  0.      ],
            [ -6.185521 ,-13.663087 ,  0.      ],
            [ -5.994012 ,-13.750999 ,  0.      ],
            [ -5.800342 ,-13.834036 ,  0.      ],
            [ -5.604859 ,-13.912706 ,  0.      ],
            [ -5.407845 ,-13.987453 ,  0.      ],
            [ -5.209557 ,-14.058745 ,  0.      ],
            [ -5.010222 ,-14.127056 ,  0.      ],
            [ -4.810047 ,-14.192857 ,  0.      ],
            [ -4.609225 ,-14.256657 ,  0.      ],
            [ -4.407872 ,-14.318758 ,  0.      ],
            [ -4.205942 ,-14.378958 ,  0.      ],
            [ -4.003402 ,-14.437076 ,  0.      ],
            [ -3.800225 ,-14.492927 ,  0.      ],
            [ -3.59639  ,-14.546326 ,  0.      ],
            [ -3.39188  ,-14.597084 ,  0.      ],
            [ -3.186691 ,-14.645017 ,  0.      ],
            [ -2.980817 ,-14.689926 ,  0.      ],
            [ -2.774296 ,-14.731756 ,  0.      ],
            [ -2.56718  ,-14.770533 ,  0.      ],
            [ -2.359517 ,-14.806268 ,  0.      ],
            [ -2.151357 ,-14.838977 ,  0.      ],
            [ -1.942745 ,-14.868673 ,  0.      ],
            [ -1.733729 ,-14.89537  ,  0.      ],
            [ -1.524352 ,-14.919082 ,  0.      ],
            [ -1.314661 ,-14.939815 ,  0.      ],
            [ -1.104693 ,-14.957542 ,  0.      ],
            [ -0.894492 ,-14.972244 ,  0.      ],
            [ -0.6841   ,-14.983893 ,  0.      ],
            [ -0.473559 ,-14.992468 ,  0.      ],
            [ -0.262916 ,-14.997944 ,  0.      ],
            [ -0.052214 ,-15.000297 ,  0.      ],
            [  0.158499 ,-14.999502 ,  0.      ],
            [  0.369177 ,-14.995572 ,  0.      ],
            [  0.579774 ,-14.988531 ,  0.      ],
            [  0.790245 ,-14.978402 ,  0.      ],
            [  1.000547 ,-14.965211 ,  0.      ],
            [  1.210635 ,-14.948979 ,  0.      ],
            [  1.420469 ,-14.929731 ,  0.      ],
            [  1.630006 ,-14.907494 ,  0.      ],
            [  1.839207 ,-14.882276 ,  0.      ],
            [  2.048024 ,-14.854066 ,  0.      ],
            [  2.256414 ,-14.822849 ,  0.      ],
            [  2.464329 ,-14.788615 ,  0.      ],
            [  2.671722 ,-14.751348 ,  0.      ],
            [  2.878544 ,-14.711034 ,  0.      ],
            [  3.084747 ,-14.66766  ,  0.      ],
            [  3.290277 ,-14.621209 ,  0.      ],
            [  3.495125 ,-14.571835 ,  0.      ],
            [  3.699296 ,-14.519728 ,  0.      ],
            [  3.902797 ,-14.465074 ,  0.      ],
            [  4.10565  ,-14.408058 ,  0.      ],
            [  4.307878 ,-14.348865 ,  0.      ],
            [  4.509509 ,-14.287672 ,  0.      ],
            [  4.710588 ,-14.224686 ,  0.      ],
            [  4.9111   ,-14.159922 ,  0.      ],
            [  5.110867 ,-14.092886 ,  0.      ],
            [  5.309692 ,-14.023108 ,  0.      ],
            [  5.507362 ,-13.950114 ,  0.      ],
            [  5.703637 ,-13.873446 ,  0.      ],
            [  5.898246 ,-13.792635 ,  0.      ],
            [  6.090914 ,-13.707291 ,  0.      ],
            [  6.281164 ,-13.616698 ,  0.      ],
            [  6.469758 ,-13.522713 ,  0.      ],
            [  6.657361 ,-13.426771 ,  0.      ],
            [  6.843815 ,-13.328612 ,  0.      ],
            [  7.02909  ,-13.228248 ,  0.      ],
            [  7.213134 ,-13.125641 ,  0.      ],
            [  7.395895 ,-13.020765 ,  0.      ],
            [  7.486607 ,-12.96718  ,  0.      ]            
        ])

        m = pymeshlab.Mesh(verts1)

    elif caseId ==2:
        projectedArea = 450.0000305175781

        verts2 = np.array([
            [ 15.      ,  -0.       ,  0.      ],
            [ 15.      ,  -0.       ,  0.      ],
            [ 14.949349,  -0.050651 ,  0.025453],
            [ 14.848047,  -0.151953 ,  0.076359],
            [ 14.746745,  -0.253255 ,  0.127265],
            [ 14.645444,  -0.354557 ,  0.178172],
            [ 14.544142,  -0.455859 ,  0.229078],
            [ 14.44284 ,  -0.557161 ,  0.279984],
            [ 14.341538,  -0.658463 ,  0.33089 ],
            [ 14.240236,  -0.759765 ,  0.381796],
            [ 14.138934,  -0.861067 ,  0.432703],
            [ 14.037633,  -0.962369 ,  0.483609],
            [ 13.936331,  -1.063672 ,  0.534513],
            [ 13.835032,  -1.164971 ,  0.585433],
            [ 13.733711,  -1.266292 ,  0.636259],
            [ 13.632521,  -1.367482 ,  0.687632],
            [ 13.530567,  -1.469435 ,  0.735818],
            [ 13.428121,  -1.57188  ,  0.781943],
            [ 13.327135,  -1.672865 ,  0.834148],
            [ 13.2259  ,  -1.774101 ,  0.88531 ],
            [ 13.124706,  -1.875293 ,  0.93665 ],
            [ 13.023506,  -1.976493 ,  0.98796 ],
            [ 12.922308,  -2.077691 ,  1.039275],
            [ 12.821109,  -2.17889  ,  1.09059 ],
            [ 12.71991 ,  -2.280088 ,  1.141904],
            [ 12.618711,  -2.381287 ,  1.193219],
            [ 12.51751 ,  -2.482486 ,  1.244532],
            [ 12.416314,  -2.583682 ,  1.295855],
            [ 12.315102,  -2.684894 ,  1.347115],
            [ 12.21398 ,  -2.786015 ,  1.39875 ],
            [ 12.112329,  -2.887666 ,  1.448192],
            [ 12.009995,  -2.990001 ,  1.494803],
            [ 11.90758 ,  -3.092417 ,  1.541082],
            [ 11.806335,  -3.193663 ,  1.592188],
            [ 11.705238,  -3.29476  ,  1.643907],
            [ 11.604116,  -3.395883 ,  1.695521],
            [ 11.502998,  -3.497001 ,  1.747153],
            [ 11.40188 ,  -3.598121 ,  1.798782],
            [ 11.300762,  -3.699239 ,  1.850412],
            [ 11.199643,  -3.800359 ,  1.902041],
            [ 11.098525,  -3.901478 ,  1.953671],
            [ 10.997406,  -4.002597 ,  2.005297],
            [ 10.896292,  -4.103712 ,  2.056944],
            [ 10.795149,  -4.204855 ,  2.108475],
            [ 10.69417 ,  -4.305835 ,  2.160676],
            [ 10.591756,  -4.408247 ,  2.206978],
            [ 10.489608,  -4.510395 ,  2.254373],
            [ 10.387299,  -4.612702 ,  2.301107],
            [ 10.285688,  -4.714312 ,  2.35071 ],
            [ 10.184718,  -4.815282 ,  2.402938],
            [ 10.083638,  -4.916362 ,  2.454715],
            [  9.982576,  -5.017423 ,  2.50657 ],
            [  9.881513,  -5.118488 ,  2.558412],
            [  9.780449,  -5.219552 ,  2.610255],
            [  9.679384,  -5.320615 ,  2.662099],
            [  9.578321,  -5.42168  ,  2.713941],
            [  9.477259,  -5.522741 ,  2.765794],
            [  9.376181,  -5.623819 ,  2.817582],
            [  9.275196,  -5.724803 ,  2.869751],
            [  9.173669,  -5.826331 ,  2.919695],
            [  9.071393,  -5.928607 ,  2.96657 ],
            [  8.969256,  -6.030743 ,  3.01402 ],
            [  8.867028,  -6.132972 ,  3.061089],
            [  8.765216,  -6.234784 ,  3.109864],
            [  8.664313,  -6.335687 ,  3.162361],
            [  8.563254,  -6.436746 ,  3.21422 ],
            [  8.462222,  -6.537779 ,  3.266187],
            [  8.361185,  -6.638815 ,  3.318136],
            [  8.260149,  -6.739851 ,  3.370088],
            [  8.159113,  -6.840888 ,  3.42204 ],
            [  8.058076,  -6.941925 ,  3.473989],
            [  7.957044,  -7.042957 ,  3.525957],
            [  7.855985,  -7.144016 ,  3.577817],
            [  7.75508 ,  -7.244921 ,  3.630303],
            [  7.653283,  -7.346718 ,  3.679141],
            [  7.551066,  -7.448935 ,  3.726266],
            [  7.448934,  -7.551067 ,  3.773734],
            [  7.346718,  -7.653283 ,  3.820859],
            [  7.244921,  -7.75508  ,  3.869697],
            [  7.144015,  -7.855986 ,  3.922183],
            [  7.042957,  -7.957044 ,  3.974043],
            [  6.941925,  -8.058076 ,  4.026011],
            [  6.840888,  -8.159113 ,  4.07796 ],
            [  6.739851,  -8.260149 ,  4.129911],
            [  6.638815,  -8.361185 ,  4.181864],
            [  6.537778,  -8.462222 ,  4.233813],
            [  6.436746,  -8.563254 ,  4.28578 ],
            [  6.335687,  -8.664313 ,  4.337639],
            [  6.234784,  -8.765216 ,  4.390135],
            [  6.132972,  -8.867028 ,  4.438911],
            [  6.030743,  -8.969257 ,  4.485981],
            [  5.928607,  -9.071393 ,  4.53343 ],
            [  5.826331,  -9.173669 ,  4.580305],
            [  5.724803,  -9.275197 ,  4.630249],
            [  5.623819,  -9.376181 ,  4.682418],
            [  5.522741,  -9.477259 ,  4.734206],
            [  5.421679,  -9.578321 ,  4.786059],
            [  5.320615,  -9.679385 ,  4.837901],
            [  5.219551,  -9.780449 ,  4.889744],
            [  5.118487,  -9.881513 ,  4.941588],
            [  5.017423,  -9.982577 ,  4.993429],
            [  4.916362, -10.083638 ,  5.045284],
            [  4.815281, -10.184718 ,  5.097061],
            [  4.714311, -10.285688 ,  5.149289],
            [  4.612702, -10.387299 ,  5.198892],
            [  4.510395, -10.489608 ,  5.245627],
            [  4.408247, -10.591756 ,  5.293022],
            [  4.305835, -10.69417  ,  5.339324],
            [  4.204855, -10.79515  ,  5.391525],
            [  4.103712, -10.896292 ,  5.443056],
            [  4.002597, -10.997406 ,  5.494703],
            [  3.901477, -11.098525 ,  5.546329],
            [  3.800359, -11.199643 ,  5.597959],
            [  3.699239, -11.300762 ,  5.649589],
            [  3.59812 , -11.40188  ,  5.701218],
            [  3.497001, -11.502999 ,  5.752847],
            [  3.395883, -11.604116 ,  5.804479],
            [  3.29476 , -11.705239 ,  5.856093],
            [  3.193663, -11.806335 ,  5.907813],
            [  3.092417, -11.907581 ,  5.958918],
            [  2.990001, -12.009995 ,  6.005197],
            [  2.887666, -12.112329 ,  6.051808],
            [  2.786015, -12.21398  ,  6.10125 ],
            [  2.684894, -12.315102 ,  6.152885],
            [  2.583682, -12.416314 ,  6.204144],
            [  2.482486, -12.517511 ,  6.255468],
            [  2.381287, -12.618711 ,  6.306781],
            [  2.280088, -12.71991  ,  6.358096],
            [  2.17889 , -12.821109 ,  6.40941 ],
            [  2.077691, -12.922308 ,  6.460724],
            [  1.976492, -13.023507 ,  6.51204 ],
            [  1.875293, -13.124707 ,  6.56335 ],
            [  1.7741  , -13.2259   ,  6.61469 ],
            [  1.672865, -13.327136 ,  6.665852],
            [  1.57188 , -13.428121 ,  6.718056],
            [  1.469435, -13.530568 ,  6.764182],
            [  1.367482, -13.632521 ,  6.812368],
            [  1.266292, -13.733711 ,  6.863741],
            [  1.164971, -13.835032 ,  6.914567],
            [  1.063672, -13.936331 ,  6.965487],
            [  0.962369, -14.037633 ,  7.016391],
            [  0.861067, -14.138934 ,  7.067298],
            [  0.759765, -14.240236 ,  7.118204],
            [  0.658463, -14.341538 ,  7.16911 ],
            [  0.557161, -14.44284  ,  7.220016],
            [  0.455859, -14.544142 ,  7.270922],
            [  0.354557, -14.645444 ,  7.321828],
            [  0.253255, -14.746745 ,  7.372735],
            [  0.151953, -14.848047 ,  7.423641],
            [  0.050651, -14.949349 ,  7.474547],
            [  0.      , -15.       ,  7.5     ],
            [  0.      , -15.       ,  7.5     ],
            [ -0.050651, -14.949349 ,  7.474547],
            [ -0.151953, -14.848047 ,  7.423641],
            [ -0.253255, -14.746745 ,  7.372735],
            [ -0.354557, -14.645444 ,  7.321828],
            [ -0.455859, -14.544142 ,  7.270922],
            [ -0.557161, -14.44284  ,  7.220016],
            [ -0.658463, -14.341538 ,  7.16911 ],
            [ -0.759765, -14.240236 ,  7.118204],
            [ -0.861067, -14.138934 ,  7.067298],
            [ -0.962369, -14.037633 ,  7.016391],
            [ -1.063672, -13.936331 ,  6.965487],
            [ -1.164971, -13.835032 ,  6.914567],
            [ -1.266292, -13.733711 ,  6.863741],
            [ -1.367482, -13.632521 ,  6.812368],
            [ -1.469435, -13.530568 ,  6.764182],
            [ -1.57188 , -13.428121 ,  6.718056],
            [ -1.672865, -13.327136 ,  6.665852],
            [ -1.7741  , -13.2259   ,  6.61469 ],
            [ -1.875293, -13.124707 ,  6.56335 ],
            [ -1.976492, -13.023507 ,  6.51204 ],
            [ -2.077691, -12.922308 ,  6.460724],
            [ -2.17889 , -12.821109 ,  6.40941 ],
            [ -2.280088, -12.71991  ,  6.358096],
            [ -2.381287, -12.618711 ,  6.306781],
            [ -2.482486, -12.517511 ,  6.255468],
            [ -2.583682, -12.416314 ,  6.204144],
            [ -2.684894, -12.315102 ,  6.152885],
            [ -2.786015, -12.21398  ,  6.10125 ],
            [ -2.887666, -12.112329 ,  6.051808],
            [ -2.990001, -12.009995 ,  6.005197],
            [ -3.092417, -11.907581 ,  5.958918],
            [ -3.193663, -11.806335 ,  5.907813],
            [ -3.29476 , -11.705239 ,  5.856093],
            [ -3.395883, -11.604116 ,  5.804479],
            [ -3.497001, -11.502999 ,  5.752847],
            [ -3.59812 , -11.40188  ,  5.701218],
            [ -3.699239, -11.300762 ,  5.649589],
            [ -3.800359, -11.199643 ,  5.597959],
            [ -3.901477, -11.098525 ,  5.546329],
            [ -4.002597, -10.997406 ,  5.494703],
            [ -4.103712, -10.896292 ,  5.443056],
            [ -4.204855, -10.79515  ,  5.391525],
            [ -4.305835, -10.69417  ,  5.339324],
            [ -4.408247, -10.591756 ,  5.293022],
            [ -4.510395, -10.489608 ,  5.245627],
            [ -4.612702, -10.387299 ,  5.198892],
            [ -4.714311, -10.285688 ,  5.149289],
            [ -4.815281, -10.184718 ,  5.097061],
            [ -4.916362, -10.083638 ,  5.045284],
            [ -5.017423,  -9.982577 ,  4.993429],
            [ -5.118487,  -9.881513 ,  4.941588],
            [ -5.219551,  -9.780449 ,  4.889744],
            [ -5.320615,  -9.679385 ,  4.837901],
            [ -5.421679,  -9.578321 ,  4.786059],
            [ -5.522741,  -9.477259 ,  4.734206],
            [ -5.623819,  -9.376181 ,  4.682418],
            [ -5.724803,  -9.275197 ,  4.630249],
            [ -5.826331,  -9.173669 ,  4.580305],
            [ -5.928607,  -9.071393 ,  4.53343 ],
            [ -6.030743,  -8.969257 ,  4.485981],
            [ -6.132972,  -8.867028 ,  4.438911],
            [ -6.234784,  -8.765216 ,  4.390135],
            [ -6.335687,  -8.664313 ,  4.337639],
            [ -6.436746,  -8.563254 ,  4.28578 ],
            [ -6.537778,  -8.462222 ,  4.233813],
            [ -6.638815,  -8.361185 ,  4.181864],
            [ -6.739851,  -8.260149 ,  4.129911],
            [ -6.840888,  -8.159113 ,  4.07796 ],
            [ -6.941925,  -8.058076 ,  4.026011],
            [ -7.042957,  -7.957044 ,  3.974043],
            [ -7.144015,  -7.855986 ,  3.922183],
            [ -7.244921,  -7.75508  ,  3.869697],
            [ -7.346718,  -7.653283 ,  3.820859],
            [ -7.448934,  -7.551067 ,  3.773734],
            [ -7.551066,  -7.448935 ,  3.726266],
            [ -7.653283,  -7.346718 ,  3.679141],
            [ -7.75508 ,  -7.244921 ,  3.630303],
            [ -7.855985,  -7.144016 ,  3.577817],
            [ -7.957044,  -7.042957 ,  3.525957],
            [ -8.058076,  -6.941925 ,  3.473989],
            [ -8.159113,  -6.840888 ,  3.42204 ],
            [ -8.260149,  -6.739851 ,  3.370088],
            [ -8.361185,  -6.638815 ,  3.318136],
            [ -8.462222,  -6.537779 ,  3.266187],
            [ -8.563254,  -6.436746 ,  3.21422 ],
            [ -8.664313,  -6.335687 ,  3.162361],
            [ -8.765216,  -6.234784 ,  3.109864],
            [ -8.867028,  -6.132972 ,  3.061089],
            [ -8.969256,  -6.030743 ,  3.01402 ],
            [ -9.071393,  -5.928607 ,  2.96657 ],
            [ -9.173669,  -5.826331 ,  2.919695],
            [ -9.275196,  -5.724803 ,  2.869751],
            [ -9.376181,  -5.623819 ,  2.817582],
            [ -9.477259,  -5.522741 ,  2.765794],
            [ -9.578321,  -5.42168  ,  2.713941],
            [ -9.679384,  -5.320615 ,  2.662099],
            [ -9.780449,  -5.219552 ,  2.610255],
            [ -9.881513,  -5.118488 ,  2.558412],
            [ -9.982576,  -5.017423 ,  2.50657 ],
            [-10.083638,  -4.916362 ,  2.454715],
            [-10.184718,  -4.815282 ,  2.402938],
            [-10.285688,  -4.714312 ,  2.35071 ],
            [-10.387299,  -4.612702 ,  2.301107],
            [-10.489608,  -4.510395 ,  2.254373],
            [-10.591756,  -4.408247 ,  2.206978],
            [-10.69417 ,  -4.305835 ,  2.160676],
            [-10.795149,  -4.204855 ,  2.108475],
            [-10.896292,  -4.103712 ,  2.056944],
            [-10.997406,  -4.002597 ,  2.005297],
            [-11.098525,  -3.901478 ,  1.953671],
            [-11.199643,  -3.800359 ,  1.902041],
            [-11.300762,  -3.699239 ,  1.850412],
            [-11.40188 ,  -3.598121 ,  1.798782],
            [-11.502998,  -3.497001 ,  1.747153],
            [-11.604116,  -3.395883 ,  1.695521],
            [-11.705238,  -3.29476  ,  1.643907],
            [-11.806335,  -3.193663 ,  1.592188],
            [-11.90758 ,  -3.092417 ,  1.541082],
            [-12.009995,  -2.990001 ,  1.494803],
            [-12.112329,  -2.887666 ,  1.448192],
            [-12.21398 ,  -2.786015 ,  1.39875 ],
            [-12.315102,  -2.684894 ,  1.347115],
            [-12.416314,  -2.583682 ,  1.295855],
            [-12.51751 ,  -2.482486 ,  1.244532],
            [-12.618711,  -2.381287 ,  1.193219],
            [-12.71991 ,  -2.280088 ,  1.141904],
            [-12.821109,  -2.17889  ,  1.09059 ],
            [-12.922308,  -2.077691 ,  1.039275],
            [-13.023506,  -1.976493 ,  0.98796 ],
            [-13.124706,  -1.875293 ,  0.93665 ],
            [-13.2259  ,  -1.774101 ,  0.88531 ],
            [-13.327135,  -1.672865 ,  0.834148],
            [-13.428121,  -1.57188  ,  0.781943],
            [-13.530567,  -1.469435 ,  0.735818],
            [-13.632521,  -1.367482 ,  0.687632],
            [-13.733711,  -1.266292 ,  0.636259],
            [-13.835032,  -1.164971 ,  0.585433],
            [-13.936331,  -1.063672 ,  0.534513],
            [-14.037633,  -0.962369 ,  0.483609],
            [-14.138934,  -0.861067 ,  0.432703],
            [-14.240236,  -0.759765 ,  0.381796],
            [-14.341538,  -0.658463 ,  0.33089 ],
            [-14.44284 ,  -0.557161 ,  0.279984],
            [-14.544142,  -0.455859 ,  0.229078],
            [-14.645444,  -0.354557 ,  0.178172],
            [-14.746745,  -0.253255 ,  0.127265],
            [-14.848047,  -0.151953 ,  0.076359],
            [-14.949349,  -0.050651 ,  0.025453],
            [-15.      ,  -0.       ,  0.      ],
            [-15.      ,  -0.       ,  0.      ]
        ])

        m = pymeshlab.Mesh(verts2)

    return projectedArea, m

def springLineCloseness(vertMatrix, vertMatrixSL):
    distant = []
    for i in range(len(vertMatrix)):
        dist=[]
        for v in range(len(vertMatrixSL)):
            matr = np.append(vertMatrix[i], vertMatrixSL[v], axis=0).reshape(2,3)
            diff = np.diff(matr, axis=0).squeeze()
            dist.append( np.linalg.norm(diff) )
        if min(dist) < 0.2:
            distant.append(0)
        else:
            distant.append(1)
    distIDs = np.flatnonzero(distant)
    return distIDs
    
def nearestValueIdx(value, array):
    ids = []
    diff = np.abs(array - np.full_like(array,value) )
    condition = np.where(diff<0.5, 1, 0)
    ids = np.flatnonzero(condition)
    return ids.tolist()


################ MAIN ################

# parser for bool argument
parser = argparse.ArgumentParser(
    prog= "freeGridBuildability",
    description= "Checks the benchmark constraints given an input mesh (.obj or .ply) and the reference  (int)"
    )
parser.add_argument('dir', help='The mesh path (.obj or .ply)')
parser.add_argument('--c', type=int, required=True, help='The reference DBG number: 0 for barrel vault, 1 for dome, 2 for hypar')
args = parser.parse_args()
print('Mesh path ' + str(args.dir))
if args.c == 0:
    print('Reference DBG is: barrel vault')
elif args.c == 1:
    print('Reference DBG is: paraboloidal dome')
elif args.c == 2:
    print('Reference DBG is: hyperbolic paraboloid')
else:
    print('Please check the input in --c to be 0 or 1 or 2')
    sys.exit(1)

# check correct mesh format
meshPath = args.dir
if  not (str(meshPath).endswith(".obj") or str(meshPath).endswith(".ply") ):
    print("Please check the mesh format (.obj or .ply)")
    sys.exit(1)
filename = os.path.split(meshPath)[1]
name = os.path.splitext(filename)[0]
DBGcase = args.c

# load the mesh
m = mesh(str(meshPath))
m.printData()

# doublecheck input
try:
    m
except NameError:
    sys.exit('Please provide a mesh (.obj or .ply)')

# import data of DBG: springline and projected area
DBGprojArea, DBGspringLine = createDBGdata(DBGcase)


# MESH CHECKS FOR DESIGN CONSTRAINTS
# single layer GC.1
m.checkManifoldness()

# no holes GC.1
m.checkHoles()

# spring line closeness GC.2
m.checkSLineCloseness(DBGspringLine)

# check max span GC.3
m.checkMaxSpan(DBGspringLine, DBGcase)

# projected area GC.4
m.checkAreaProjection(DBGprojArea)

# rise GC.5
m.checkRise()

# max and min z coordinate of nodes GC.6 adn GC.7
m.chekNodesZspan()
